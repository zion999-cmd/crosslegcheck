# 坐姿分类系统使用说明

## 🎯 项目概述

基于16×16压力传感器阵列（256通道）的坐姿分类系统，能够识别三种坐姿：
- **normal** - 正常坐姿
- **crossleg_left** - 左腿交叉
- **crossleg_right** - 右腿交叉

## 📁 文件说明

### 训练相关文件
- `train_posture_classifier.py` - 主训练脚本
- `normal.csv` - 正常坐姿训练数据
- `crossleg_left.csv` - 左腿交叉坐姿训练数据  
- `crossleg_right.csv` - 右腿交叉坐姿训练数据

### 模型文件
- `model_svm.pkl` - 训练好的SVM分类模型
- `scaler.pkl` - 数据标准化器
- `pca.pkl` - PCA降维器（256维→20维）

### 预测相关文件
- `predict_posture.py` - 预测接口脚本
- `confusion_matrix.png` - 混淆矩阵可视化

## 🚀 快速开始

### 1. 环境准备
```bash
conda activate crosslegcheck
conda install pandas numpy scikit-learn matplotlib seaborn -y
```

### 2. 训练模型
```bash
python train_posture_classifier.py
```

### 3. 使用预测接口
```bash
python predict_posture.py
```

## 📊 训练结果

### 模型性能
- **训练集准确率**: 100%
- **测试集准确率**: 100%
- **数据集大小**: 933个样本
  - normal: 263个样本
  - crossleg_left: 300个样本  
  - crossleg_right: 370个样本

### 模型参数
- **算法**: SVM (支持向量机)
- **核函数**: RBF
- **正则化参数**: C=10
- **gamma**: scale
- **特征维度**: 256 → 20 (PCA降维)
- **方差保留率**: 91.8%

## 🔧 使用方法

### 训练新模型
```python
# 运行训练脚本
python train_posture_classifier.py

# 输出文件：
# - model_svm.pkl (SVM模型)
# - scaler.pkl (标准化器)  
# - pca.pkl (PCA降维器)
# - confusion_matrix.png (混淆矩阵)
```

### 单样本预测
```python
from predict_posture import PostureClassifier

# 初始化分类器
classifier = PostureClassifier()

# 预测单个样本（256维压力数据）
pressure_data = [0, 10, 20, ...]  # 256个数值
prediction, confidence = classifier.predict_single(pressure_data)

print(f"预测坐姿: {prediction}")
print(f"置信度: {confidence:.4f}")
```

### 批量预测
```python
# 从CSV文件预测
predictions = classifier.predict_from_csv('new_data.csv')

# 批量预测多个样本
pressure_data_list = [[...], [...], [...]]  # 每个子列表包含256个数值
results = classifier.predict_batch(pressure_data_list)
```

## 📈 数据格式

### 输入数据格式
- **CSV文件格式**: 
  - 第1列: 时间戳（将被忽略）
  - 第2-257列: F1(g) 到 F256(g) 压力值
  - 编码: GBK/GB2312

### 压力传感器布局
- **传感器阵列**: 16×16 = 256个传感器
- **数据单位**: 克(g)
- **数据范围**: 0-几千克（根据人体重量和坐姿分布）

## 🎛️ 自定义配置

### 修改训练参数
在 `train_posture_classifier.py` 中修改：
```python
# SVM参数
clf = svm.SVC(
    kernel='rbf',    # 核函数：rbf, linear, poly
    C=10,           # 正则化参数
    gamma='scale'   # gamma参数
)

# PCA参数
pca = decomposition.PCA(n_components=20)  # 降维目标维度
```

### 修改数据预处理
```python
# 是否使用PCA降维
X, y, scaler, pca = preprocess_data(df, use_pca=True, n_components=20)

# 训练集比例
X_train, X_test, y_train, y_test = model_selection.train_test_split(
    X, y, test_size=0.2, random_state=42, stratify=y
)
```

## 🔍 故障排除

### 常见问题

1. **编码错误**
   ```
   UnicodeDecodeError: 'utf-8' codec can't decode...
   ```
   - 解决方案：脚本已自动处理多种编码（GBK、GB2312、UTF-8等）

2. **数据维度错误**
   ```
   ValueError: 输入数据必须为256维
   ```
   - 解决方案：确保输入数据包含256个压力值

3. **模型文件不存在**
   ```
   FileNotFoundError: 模型文件不存在
   ```
   - 解决方案：先运行 `train_posture_classifier.py` 生成模型文件

### 日志说明
- ✅ 表示操作成功
- ⚠️ 表示警告信息
- ❌ 表示错误信息

## 🚀 未来优化方向

1. **特征工程**
   - 添加左右压力差特征
   - 计算重心偏移量
   - 压力分布梯度特征

2. **时间序列特征**
   - 滑动窗口平均
   - 压力变化趋势
   - 时间序列稳定性

3. **模型优化**
   - 尝试其他算法（Random Forest、XGBoost等）
   - 超参数调优
   - 集成学习方法

4. **部署优化**
   - 转换为轻量级模型（便于STM32H750部署）
   - 量化压缩
   - TinyML优化

## 📞 技术支持

如需技术支持或有疑问，请检查：
1. 环境配置是否正确
2. 数据格式是否符合要求
3. 模型文件是否完整
4. 参考本文档的故障排除部分